<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mariages | Golden Promise</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;500&family=Montserrat:wght@300;500;600&family=Parisienne&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --rose-gold: #c5a059;
            --silk: #fcfaf8;
            --text: #2d2a26;
            --white: #ffffff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--silk);
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 280px;
            background: var(--white);
            border-right: 1px solid rgba(197, 160, 89, 0.1);
            padding: 40px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        .logo {
            padding: 0 40px;
            margin-bottom: 30px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            letter-spacing: 3px;
        }
        .logo span {
            font-family: 'Parisienne', cursive;
            color: var(--rose-gold);
        }
        .menu-list { list-style: none; }
        .menu-item { padding: 0 20px; margin-bottom: 5px; }
        .menu-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: var(--text);
            text-decoration: none;
            border-radius: 50px;
            font-size: 0.75rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: 0.6;
            transition: 0.3s;
        }
        .menu-link:hover, .menu-link.active {
            background: rgba(197, 160, 89, 0.1);
            opacity: 1;
        }
        .menu-link i { color: var(--rose-gold); }
        .logout-btn {
            margin: 30px 20px;
            padding: 15px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 50px;
            width: calc(100% - 40px);
            cursor: pointer;
            font-size: 0.75rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 60px;
        }
        header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 10px;
        }
        header p {
            font-family: 'Parisienne', cursive;
            font-size: 1.8rem;
            color: var(--rose-gold);
            margin-bottom: 40px;
        }
        .actions-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .search-box {
            padding: 12px 20px;
            border: 2px solid rgba(197, 160, 89, 0.2);
            border-radius: 50px;
            width: 300px;
            outline: none;
        }
        .btn {
            padding: 12px 30px;
            background: var(--rose-gold);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.85rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-left: 10px;
        }
        .btn:hover { opacity: 0.9; }
        .table-container {
            background: var(--white);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            text-align: left;
            padding: 20px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--rose-gold);
            border-bottom: 2px solid var(--silk);
        }
        td {
            padding: 20px;
            border-bottom: 1px solid var(--silk);
        }
        tr:hover { background: var(--silk); }
        .status {
            padding: 6px 15px;
            border-radius: 50px;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .status-confirme { background: rgba(143, 163, 130, 0.15); color: #5a6b4e; }
        .status-planifie { background: rgba(245, 158, 11, 0.1); color: #F59E0B; }
        .status-termine { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .action-btns {
            display: flex;
            gap: 10px;
        }
        .btn-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: var(--silk);
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-icon:hover {
            background: var(--rose-gold);
            color: white;
        }
        
        /* RTL Support */
        body[dir="rtl"] .sidebar {
            border-right: none;
            border-left: 1px solid rgba(197, 160, 89, 0.1);
        }
        body[dir="rtl"] .main-content {
            margin-left: 0;
            margin-right: 280px;
        }
        body[dir="rtl"] .menu-link {
            flex-direction: row-reverse;
        }
        body[dir="rtl"] .actions-bar {
            flex-direction: row-reverse;
        }
        body[dir="rtl"] table {
            direction: rtl;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">Golden <span>Promise</span></div>
        
        <div style="padding: 0 20px; margin-bottom: 30px;">
            <select id="langSelect" onchange="setLang(this.value)" style="
                width: 100%;
                padding: 12px;
                border: 2px solid rgba(197, 160, 89, 0.2);
                border-radius: 50px;
                background: white;
                cursor: pointer;
                font-size: 0.85rem;
                outline: none;
                text-align: center;
            ">
                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                <option value="en">ðŸ‡¬ðŸ‡§ English</option>
                <option value="ar">ðŸ‡²ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            </select>
        </div>

        <ul class="menu-list">
            <li class="menu-item">
                <a href="dashboard.html" class="menu-link">
                    <i class="fas fa-chart-line"></i> 
                    <span data-i18n="dashboard">Tableau de bord</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="clients.html" class="menu-link">
                    <i class="fas fa-users"></i> 
                    <span data-i18n="clients">Clients</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="mariages.html" class="menu-link active">
                    <i class="fas fa-heart"></i> 
                    <span data-i18n="mariages">Mariages</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="prestataires.html" class="menu-link">
                    <i class="fas fa-briefcase"></i> 
                    <span data-i18n="prestataires">Prestataires</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="paiements.html" class="menu-link">
                    <i class="fas fa-credit-card"></i> 
                    <span data-i18n="paiements">Paiements</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="messages.html" class="menu-link">
                    <i class="fas fa-envelope"></i> 
                    <span data-i18n="messages">Messages</span>
                </a>
            </li>
        </ul>
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> 
            <span data-i18n="logout">DÃ©connexion</span>
        </button>
    </div>

    <div class="main-content">
        <header>
            <h1 data-i18n="mariages_title">Gestion des Mariages</h1>
            <p data-i18n="mariages_subtitle">Planning de vos Ã©vÃ©nements</p>
        </header>

        <div class="actions-bar">
            <input type="text" class="search-box" id="searchInput" data-i18n="search" placeholder="Rechercher...">
            <div>
                <button class="btn" onclick="openModal()">
                    <i class="fas fa-plus"></i> 
                    <span data-i18n="add_wedding">Ajouter Mariage</span>
                </button>
                <button class="btn" onclick="exportCSV()">
                    <i class="fas fa-download"></i> 
                    <span data-i18n="export">Export CSV</span>
                </button>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th data-i18n="id">ID</th>
                        <th data-i18n="couple">Couple</th>
                        <th data-i18n="date">Date</th>
                        <th data-i18n="location">Lieu</th>
                        <th data-i18n="guests">InvitÃ©s</th>
                        <th data-i18n="budget">Budget</th>
                        <th data-i18n="status">Statut</th>
                        <th data-i18n="actions">Actions</th>
                    </tr>
                </thead>
                <tbody id="mariagesTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        function logout() {
            window.location.href = 'index.html';
        }

        // RÃ©cupÃ©rer les donnÃ©es des clients
        const allData = JSON.parse(localStorage.getItem('goldenpromise_data') || '{}');
        const clients = allData.clients || [];

        // CrÃ©er des mariages basÃ©s sur les clients actifs
        const mariages = clients.filter(c => c.statut === 'actif').map((client, index) => ({
            id: index + 1,
            clientId: client.id,
            couple: `${client.nom} & ${client.partenaire}`,
            date: client.dateMariage,
            lieu: ['Palais Majorelle', 'La Mamounia', 'Royal Mansour', 'Le Jardin Secret'][index % 4],
            invites: Math.floor(Math.random() * 200) + 100,
            budget: client.budget,
            statut: index % 2 === 0 ? 'confirme' : 'planifie'
        }));

        function renderTable() {
            const tbody = document.getElementById('mariagesTable');
            tbody.innerHTML = mariages.map(mariage => `
                <tr>
                    <td>${mariage.id}</td>
                    <td><strong>${mariage.couple}</strong></td>
                    <td>${new Date(mariage.date).toLocaleDateString('fr-FR')}</td>
                    <td>${mariage.lieu}</td>
                    <td>${mariage.invites}</td>
                    <td>${mariage.budget.toLocaleString()} MAD</td>
                    <td><span class="status status-${mariage.statut}">${mariage.statut === 'confirme' ? 'ConfirmÃ©' : 'PlanifiÃ©'}</span></td>
                    <td class="action-btns">
                        <button class="btn-icon" onclick="viewClient(${mariage.clientId})" title="Voir dÃ©tails">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon" onclick="editMariage(${mariage.id})" title="Modifier">
                            <i class="fas fa-pen"></i>
                        </button>
                        <button class="btn-icon" onclick="deleteMariage(${mariage.id})" title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Rediriger vers les dÃ©tails du client
        function viewClient(clientId) {
            localStorage.setItem('selectedClientId', clientId);
            window.location.href = `client-details.html?id=${clientId}`;
        }

        function editMariage(id) {
            alert(`Modifier le mariage #${id}`);
        }

        function deleteMariage(id) {
            if (confirm(t[currentLang].delete_confirm || 'Voulez-vous vraiment supprimer ce mariage ?')) {
                const index = mariages.findIndex(m => m.id === id);
                mariages.splice(index, 1);
                renderTable();
            }
        }

        function openModal() {
            alert('FonctionnalitÃ© d\'ajout de mariage - Ã€ dÃ©velopper');
        }

        function exportCSV() {
            let csv = 'ID;Couple;Date;Lieu;InvitÃ©s;Budget;Statut\n';
            mariages.forEach(m => {
                csv += `${m.id};${m.couple};${m.date};${m.lieu};${m.invites};${m.budget};${m.statut}\n`;
            });
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mariages.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Recherche
        document.addEventListener('DOMContentLoaded', () => {
            renderTable();
            
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#mariagesTable tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(term) ? '' : 'none';
                });
            });
        });
    </script>

    <script>
    let currentLang = 'fr';
    
    const t = {
        fr: {
            dashboard: "Tableau de bord", clients: "Clients", mariages: "Mariages",
            prestataires: "Prestataires", paiements: "Paiements", messages: "Messages",
            logout: "DÃ©connexion", mariages_title: "Gestion des Mariages",
            mariages_subtitle: "Planning de vos Ã©vÃ©nements",
            search: "Rechercher...", add_wedding: "Ajouter Mariage", export: "Export CSV",
            id: "ID", couple: "Couple", date: "Date", location: "Lieu", 
            guests: "InvitÃ©s", budget: "Budget", status: "Statut", actions: "Actions",
            delete_confirm: "Voulez-vous vraiment supprimer ce mariage ?"
        },
        en: {
            dashboard: "Dashboard", clients: "Clients", mariages: "Weddings",
            prestataires: "Vendors", paiements: "Payments", messages: "Messages",
            logout: "Logout", mariages_title: "Wedding Management",
            mariages_subtitle: "Planning of your events",
            search: "Search...", add_wedding: "Add Wedding", export: "Export CSV",
            id: "ID", couple: "Couple", date: "Date", location: "Location",
            guests: "Guests", budget: "Budget", status: "Status", actions: "Actions",
            delete_confirm: "Do you really want to delete this wedding?"
        },
        ar: {
            dashboard: "Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", clients: "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡", mariages: "Ø­ÙÙ„Ø§Øª Ø§Ù„Ø²ÙØ§Ù",
            prestataires: "Ù…Ù‚Ø¯Ù…Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø§Øª", paiements: "Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª", messages: "Ø§Ù„Ø±Ø³Ø§Ø¦Ù„",
            logout: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", mariages_title: "Ø¥Ø¯Ø§Ø±Ø© Ø­ÙÙ„Ø§Øª Ø§Ù„Ø²ÙØ§Ù",
            mariages_subtitle: "ØªØ®Ø·ÙŠØ· ÙØ¹Ø§Ù„ÙŠØ§ØªÙƒ",
            search: "Ø¨Ø­Ø«...", add_wedding: "Ø¥Ø¶Ø§ÙØ© Ø²ÙØ§Ù", export: "ØªØµØ¯ÙŠØ± CSV",
            id: "Ø§Ù„Ù…Ø¹Ø±Ù", couple: "Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†", date: "Ø§Ù„ØªØ§Ø±ÙŠØ®", location: "Ø§Ù„Ù…ÙƒØ§Ù†",
            guests: "Ø§Ù„Ø¶ÙŠÙˆÙ", budget: "Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©", status: "Ø§Ù„Ø­Ø§Ù„Ø©", actions: "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
            delete_confirm: "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ù‚Ù‹Ø§ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø²ÙØ§ÙØŸ"
        }
    };

    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('lang', lang);
        document.documentElement.lang = lang;
        document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
        
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (t[lang] && t[lang][key]) {
                if (el.placeholder !== undefined) el.placeholder = t[lang][key];
                else el.textContent = t[lang][key];
            }
        });
    }

    window.addEventListener('DOMContentLoaded', () => {
        const lang = localStorage.getItem('lang') || 'fr';
        currentLang = lang;
        setLang(lang);
        const sel = document.getElementById('langSelect');
        if (sel) sel.value = lang;
    });
    </script>

</body>
</html>
